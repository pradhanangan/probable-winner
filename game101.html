<!DOCTYPE html>
<html lang="en">
<head>
	<title>Mattiliceous</title>
	<!-- Bootstrap core CSS -->
    <link href="./bootstrap-3.2.0-dist/css/bootstrap.min.css" rel="stylesheet">
	<style>
		/* Sticky footer styles
		-------------------------------------------------- */
		html {
			position: relative;
			min-height: 100%;
		}
		body {
			/* Margin bottom by footer height */
			margin-bottom: 60px;
			color: #66615b;
		}
		.footer {
			position: absolute;
			bottom: 0;
			width: 100%;
			/* Set the fixed height of the footer here */
			height: 60px;
			background-color: #f5f5f5;
		}


		/* Custom page CSS
		-------------------------------------------------- */
		/* Not required for template or sticky footer method. */

		.container {
			width: auto;
			max-width: 860px;
			padding: 0 15px;
		}
		.container .text-muted {
			margin: 20px 0;
		}
		
		/* NP defined */
		.label_num {
			height: 100px; 
			line-height: 100px; 
			text-align: center; 
			font-size: 36px; 
			font-weight: bold;
		}
		* { padding: 0; margin: 0; }
		canvas { 
		background: url(images/picture1.png); 
		display: block; 
		margin: 0 auto; 
		}
	</style>
</head>
<body>
	<!-- Begin page content -->
	<div class="container">
		<div class="page-header">
			<h1>Mattiliceous<h1>
		</div>
	</div>
	<div>
	<br/>
	<!-- Main content -->
	<div  class="container">
		<div class="row">
			<div class="col-md-12">
				<div class="row">
					
					<div class="col-md-3">
						<input type="button" id="btnNew" value="New game" onclick="init()" class="btn btn-default" />
					</div>
					
					<div class="col-md-5" style="1px solid black; height: 306px;">
						<canvas id="mycanvas" height="300" width="310" style></canvas>
					</div>
					
					<div class="col-md-4">
					
						<div class="row">
						<div class="container">
							<div class="row">
								<div class="col-sm-4" style="height: 60px; text-align:center; line-height: 60px;">
									LEVEL
								</div>
								<div id="divLevel" class="col-sm-4" style="background-color: #99ff99; width:60px; height:60px; border-radius:60px; font-weight:bold; text-align:center; line-height:60px;">
									&nbsp;
								</div>
							</div>
							<div class="row">
								<div class="col-sm-4" style="height: 60px; text-align:center; line-height: 60px;">
									SCORE
								</div>
								<div id="divScore" class="col-sm-4" style="background-color: #99ff99; width:60px; height:60px; border-radius:60px; font-weight:bold; text-align:center; line-height:60px;">
									&nbsp;
								</div>
							</div>
							<br/>
							<div class="row">
								<div class="col-sm-4" style="height: 60px; text-align:center; line-height: 60px;">
									HIT
								</div>
								<div id="divHit" class="col-sm-4" style="background-color:#ff9999; width:60px; height:60px; border-radius: 60px; font-weight:bold; text-align:center; line-height: 60px;">
									&nbsp;
								</div>
							</div>
						</div>
						</div>
						
						<br/>
						
						<div class="row">
							<div id="divStatus" style="padding:10px; text-align:center; font-weight: bold;" >&nbsp;</div>
						</div>
						
						<br />
						
						<div class="row" style="text-align:center;">
							<input type="button" id="btnCont" value="Continue" onclick="cont()" class="btn btn-default" style="visibility: 'hidden'"/>
						</div>
						<div class="row">Counter: <div id="counter"></div>
						Times: <div id="time"></div>
						</div>
					</div>
					</div> 
				</div>
			</div>
			</div>
	</div>
	<footer class="footer">
		<div class="container">
			<p class="text-muted">&copy Nripendra Pradhananga</p>
		</div>
	</footer>
	
	<script>
		var canvas = document.getElementById("mycanvas");
		var ctx = canvas.getContext("2d");
		
		// constants
		var NUM_TRACKS = 3;
		var WIDTH_OF_TRACK = canvas.width/NUM_TRACKS;
		
		
		
		
		var timer = null;
		var balls = [];
		
		var level = 1;
		
		var hit = 0;
		var score = 0;
		var prevScore = 0;
		
		var time = 100;
		
		var counter = 0;
		//var x = canvas.width/2;
		var x = 225;
		var y = 0;
		var rightPressed = false, leftPressed = false;
		
		var dx = 2;
		var dy = 2;
		
		
		// paddle definition.
		//var paddleHeight = 10;
		//var paddleWidth = 70;
		var paddleHeight = 41;
		var paddleWidth = 41;
		var paddleX = (canvas.width-paddleWidth)/2; // start from the middle.
		
		document.addEventListener("keydown", keyDownHandler, false);
		document.addEventListener("keyup", keyUpHandler, false);
		//
		
		function keyDownHandler(e) {
			if(e.keyCode == 39) {
				rightPressed = true;
			}
			else if(e.keyCode == 37) {
				leftPressed = true;
			}
		}

		function keyUpHandler(e) {
			if(e.keyCode == 39) {
				rightPressed = false;
			}
			else if(e.keyCode == 37) {
				leftPressed = false;
			}
		}
		
		function drawPaddle() {
			var imgObj = new Image();
			imgObj.src = "images/cat2.png";
			ctx.drawImage(imgObj, paddleX, canvas.height - paddleWidth);

			//ctx.beginPath();
			//ctx.rect(paddleX, canvas.height - paddleHeight, paddleWidth, paddleHeight);
			//ctx.fillStyle = "#0095DD";
			//ctx.fill();
			//ctx.closePath();
		}

		function createBall(){
			var ball = {};
			var imgObj = new Image();
			imgObj.src = "images/car09.png";
			ball.img = imgObj;
			ball.x = genX();
			ball.y = 0;
			//ball.r = 10;
			//ball.sAngle = 0; 
			//ball.eAngle = Math.PI*2;
			balls.push(ball);
		}
		
		function genX() {
			var ran = genRandomNum(3);
			return (((WIDTH_OF_TRACK - paddleWidth) / 2) + (WIDTH_OF_TRACK * ran));
			//switch(ran) {
				//case 0:
				//return 50;
				//case 1:
				//return 150;
				//case 2:
				//return 250;
			//}
			//return 150;
		}
		
		function  drawBall() {
			
			if((score %  10) === 0) {
				if(prevScore != score) {				
					prevScore = score;
					time -= 10;
					level += 1;
					document.getElementById("divLevel").innerHTML = level;
				}
			}
		
			document.getElementById("counter").innerHTML = counter;
			document.getElementById("time").innerHTML = time;
			//if(time <= 0) { time = 10;}
			console.log("time: " + time);
			
			//if(counter == 0) { createBall(); }
			if(( counter % time) == 0) {
				createBall();
			}
			var ballIndex = 0;
			balls.forEach(function(o){
				//var imgObj = new Image();
				//imgObj.src = "images/car09.png";
				ctx.drawImage(o.img, o.x, o.y);
				//ctx.fillStyle = '#0095DD';
				//ctx.beginPath();
				//ctx.arc(o.x, o.y, o.r, o.sAngle, o.eAngle);
				console.log("ball x: " + o.x);
				console.log("paddle start: " + paddleX);
				console.log("paddle end: " + (paddleX + paddleWidth));
				console.log(o.y);
				console.log( (canvas.height - paddleHeight));
				ctx.fill();				
				ctx.closePath();
				if(o.y > 250)
				debugger;
				
				// collision detection
				if((o.x >= paddleX && o.x <= (paddleX + paddleWidth)) && ((o.y + (paddleHeight - 10)) >= (canvas.height - paddleHeight))) {	
					stopTimer();
					document.getElementById("divHit").innerHTML = parseInt(document.getElementById("divHit").innerHTML) + 1;
					if(parseInt(document.getElementById("divHit").innerHTML) === 3) {
						document.getElementById("divStatus").innerHTML = "GAME OVER !!!";
						document.getElementById("divStatus").style.background = 'red';
						document.getElementById("btnCont").style.visibility = 'hidden';
					} else {
						document.getElementById("divStatus").innerHTML = "YOU ARE HIT !!!";
						document.getElementById("divStatus").style.background = '#ffcc99';
						document.getElementById("btnCont").style.visibility = 'visible';
					}
				}
				
				// out of boundry
				if(o.y >= canvas.height - paddleHeight) {
					score += 1;
					document.getElementById("divScore").innerHTML = parseInt(document.getElementById("divScore").innerHTML) + 1;
					balls.splice(ballIndex, 1);
				} else { // still inside the boundry 
					o.y += dy; 
				}
				
				ballIndex++;
			})
			counter++;	
		}
				
		function render() {	
			ctx.clearRect(0, 0, canvas.width, canvas.height);
			drawBall();
			drawPaddle();
		
			if(rightPressed && paddleX < canvas.width-(paddleWidth + 29.5)) {
				debugger;
				paddleX += canvas.height/3;
				rightPressed = false;
			}
			else if(leftPressed && paddleX > 29.5) {
				debugger;
				paddleX -= canvas.height/3;
				leftPressed = false;
			}
		}
		
		function genRandomNum(top) {
			return Math.floor(Math.random() * top);
		}
		
		function startTimer() {
			timer = setInterval(render, 10);
		}
		
		function stopTimer() {
			clearTimeout(timer);
		}
		
		function cont() {
			balls = [];
			document.getElementById("divStatus").innerHTML = "&nbsp;";
			document.getElementById("divStatus").style.background = '#ffffff';
			document.getElementById("btnCont").style.visibility = 'hidden';
			startTimer();
			if(time == 0) {
				time = 100;
			}
		}
		
		function init() {
			level = 1;
			score = 0;
			prevScore = 0;
			hit = 0;
			counter = 0;
			time = 100;
			balls = [];
			document.getElementById("divScore").innerHTML = score
			document.getElementById("divHit").innerHTML = hit;
			document.getElementById("divLevel").innerHTML = level;
			document.getElementById("divStatus").innerHTML = "&nbsp;";
			document.getElementById("divStatus").style.background = '#ffffff';
			document.getElementById("btnCont").style.visibility = 'hidden';
			startTimer();
		}
		
		//init();
	</script>
</body>
</html>